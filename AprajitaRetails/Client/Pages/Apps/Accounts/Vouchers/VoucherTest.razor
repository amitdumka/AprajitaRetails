@page "/vochers/test"

@inherits AprajitaRetails.Client.Shared.Test.IndexView

@using AprajitaRetails.Commons
@using AprajitaRetails.Shared.AutoMapper.DTO;
@using AprajitaRetails.Shared.Models.Vouchers;
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using AprajitaRetails.Shared
@using AprajitaRetails.Client.Helpers
@using AprajitaRetails.Shared.ViewModels;
@using Syncfusion.Blazor.Grids
@using System.Globalization;
@using AprajitaRetails.Aks

@inject DataHelper Helper
@inject ClientSetting Setting
@inject NavigationManager NavigationManager

<EntityGridIndex TItem="CashVoucherDTO" Title="Vouchers[Cash]" Columns="@GridCols" @bind-Entities=@entities @bind-GroupedColumn="@GroupedColumn"  Grouping=true/>

@code {
    private List<CashVoucherDTO>? entities;

    public VoucherTest()
    {
    }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            GroupedColumn = new string[] { "VoucherType" };
            InitView();
            FetchDataAsync();
            GenerateColums(typeof(CashVoucherDTO).GetProperties(), "VoucherNumber");
            StateHasChanged();
            base.OnInitialized();

        }
        catch (Exception exception)
        {

            Helper.Msg("Error On Init", exception.Message, true);
        }

    }

    async void FetchDataAsync()
    {
        entities = await Helper.FetchAsync<CashVoucherDTO>($"CashVouchers/bystoredto", $"?storeid={Setting.StoreCode}");
        StateHasChanged();
    }

}